# bot-logger-api

## назначение

Дополнение к телеграм боту [bot-logger](https://github.com/neutral-jungle-creep/bot-logger) для удобного просмотра истории телеграм чата из базы данных.

## обработчики событий

### auth/sign-up

POST запрос, для регистрации пользователей в сервисе.
Зарегистрироваться получится только пользователям, которые в данный момент находятся в чате телеграм.

Тело запроса должно иметь вид:

```json
{
    "id": 1111,
    "username": "test_user",
    "password": "111"
}
```

- **id** - уникальный телеграм айди пользователя, можно узнать написав боту [@getmyid_bot](https://t.me/getmyid_bot)
- **username** - имя пользователя, с помощью которого будет осуществляться вход в сервис.
- **password** - пароль, с помощью которого будет осуществляться вход в сервис.

Если телеграм айди пользователя введен не верно или пользователь отсутствует в чате, зарегистрироваться не удастся и в ответ будет получено сообщение:
_"пользователь не найден в чате телеграм, для того, чтобы зарегистрироваться или авторизоваться, получите приглашение в чат"_

При успешной регистрации будет получен ответ: _"регистрация прошла успешно"_
В существующую запись участника чата в базе данных добавляется захешированный пароль и имя пользователя для входа на сервис.


Если учетная запись пользователя уже существует в системе, будет получен ответ: _"пользователь уже существует"_


### auth/sign-in

POST запрос для авторизации пользователей в сервисе.

Тело запроса должно иметь вид:
```json
{
    "id": 1111,
    "username": "test_user",
    "password": "111"
}
```

- **id** - уникальный телеграм айди пользователя, можно узнать написав боту [@getmyid_bot](https://t.me/getmyid_bot)
- **username** - имя пользователя, которое было указано при регистрации.
- **password** - пароль, который был указан при регистрации.

Если данные пользователя введены не верно или пользователь отсутствует в чате, авторизоваться не удастся и в ответ будет получено сообщение:
_"пользователь не найден в чате телеграм, для того, чтобы зарегистрироваться или авторизоваться, получите приглашение в чат"_

При успешной авторизации в качестве ответа будет получен токен авторизации и сообщение о том, что авторизация прошла успешно.

### show/messages

GET запрос для просмотра истории сообщений телеграм чата

Полученный при успешной авторизации токен нужно вставить в header запроса.

Ответ будет иметь вид:
```json
[
  {
  "Id": 9,
  "Sender": "arrrrseniy",
  "Date": "2022-10-30 23:52:01",
  "Text": "проверка",
  "IsEdit": false
  },
  {
  "Id": 10,
  "Sender": "arrrrseniy",
  "Date": "2022-10-30 23:52:18",
  "Text": "новое сообщение!!!!!!",
  "IsEdit": true
  }
]
```

- **Id** - айди сообщения в чате телеграм
- **Sender** - никнейм пользователя телеграм, который отправил сообщение.
- **Date** - дата и время отправки сообщения
- **Text** - текст сообщения
- **IsEdit** - флаг, означающий, было ли сообщение отредактировано

## инструкция настройки и запуска

Чтобы запустить сервис, нужно набрать в консоли в папке с проектом команду:
```
go run .\cmd\bot-logger-api.go
```
Если флаги не указаны, сервис будет искать файл конфигурации в пути по умолчанию: директория **configs**, файл **config**.
Для того чтобы указать свои путь и название файла конфигурации можно добавить флаги в команду:
- **--path** или **-p** - путь до директории с файлом конфигурации
- **--config** или **-с** - название файла конфигурации без расширения
```
go run .\cmd\bot-logger-api.go --path my_folder --config my_config 
```

Предпочтительный формат файла конфигурации - **yml**, так же допустимо использовать **json** или **toml**.
Файл должен иметь вид:
Для запуска сервиса требуется создать в папке **configs** файл конфигурации **config.yml**, который имеет вид:

```yml
httpPort: "8000"
dbLink: "postgres://postgres:111@localhost:5432/test_db"
logFile: "logs.log"
```

### пояснения к полям:

- **httpPort** - порт на котором запустится сервис
- **dbLink** - ссылка для подключения к базе данных
- **logFile** - файл, в который будут сохраняться логи
